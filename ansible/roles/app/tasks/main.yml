---
- name: Create littlesis group
  group:
    name: littlesis
    state: present

- name: Create littlesis user
  user:
    name: littlesis
    group: littlesis
    shell: /bin/bash

- name: Install required packages
  apt:
    cache_valid_time: 3600
    update_cache: yes
    name: "{{ littlesis_app_packages }}"
  tags: packages

- import_tasks: nodejs.yml
  tags: nodejs

- import_tasks: scripts.yml
  tags: scripts
  when: littlesis_app_role == 'app'

- import_tasks: redis.yml
  tags: redis
  when: littlesis_app_role == 'app'

- import_tasks: manticore.yml
  tags: manticore
  when: littlesis_app_role == 'app'

- import_tasks: firefox.yml
  tags: firefox

- import_tasks: ruby.yml
  tags: ruby

# the variable littlesis_rails_version sets the git branch or commit
- import_tasks: rails.yml
  tags: deploy

- import_tasks: nginx.yml
  become: true
  tags:
    - server
    - nginx
  when: littlesis_app_role == 'app'

- import_tasks: puma.yml
  become: true
  tags:
    - server
    - puma
  when: littlesis_app_role == 'app'

- import_tasks: static.yml
  tags: static
  when: littlesis_app_role == 'app'

- import_tasks: tasks.yml
  tags:
    - tasks
    - cron
  when: littlesis_app_role == 'app'
